---
phase: 02-mermaid-implementation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [inspektionen-flowchart.md, preview-flowchart.html]
autonomous: false

must_haves:
  truths:
    - "Mermaid diagram renders without errors in a standard Mermaid viewer"
    - "All 29 nodes from flowchart-content.md are present with correct shapes and German labels"
    - "All 31 edges from flowchart-content.md are connected with correct labels"
    - "Three inspection branches render side-by-side with frequency labels"
    - "Footnote box and legend box are inside the diagram as styled nodes"
    - "Terminology uses renamed terms (Sichtkontrolle, Funktionskontrolle, Jahreshauptinspektion) with original norm terms in footnotes"
  artifacts:
    - path: "inspektionen-flowchart.md"
      provides: "Complete Mermaid flowchart with styling, footnotes, and legend"
      contains: "flowchart TD"
  key_links:
    - from: "flowchart-content.md node/edge tables"
      to: "inspektionen-flowchart.md Mermaid syntax"
      via: "1:1 translation of all 29 nodes and 31 edges"
      pattern: "START|D01|N01|N02|N03|N04|E00|E01|E02|E03|E04|P01|P02|P03|P04|P05|P06|P07|D02|D03|D04|D05|D06|END"
---

<objective>
Create the complete Mermaid flowchart for playground inspection obligations, translating all content from Phase 1's flowchart-content.md into valid, fully styled Mermaid syntax with footnotes and legend inside the diagram.

Purpose: This is the core deliverable of Phase 2 ‚Äî a self-contained, rendering Mermaid diagram that a visual designer can recreate without playground safety expertise.
Output: inspektionen-flowchart.md containing a complete Mermaid code block.
</objective>

<execution_context>
@/Users/jean-pierrekoenig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jean-pierrekoenig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-mermaid-implementation/02-CONTEXT.md
@.planning/phases/01-content-logic/01-01-SUMMARY.md
@flowchart-content.md
@existing-playground-flowchart.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create complete Mermaid flowchart with all nodes, edges, styling, footnotes, and legend</name>
  <files>inspektionen-flowchart.md</files>
  <action>
Create `inspektionen-flowchart.md` containing a Mermaid code block that translates ALL content from flowchart-content.md.

**Diagram structure ‚Äî `flowchart TD`:**

1. **Starting fork (2 nodes):**
   - START as rounded-rect: `START(["Spielplatz-Inspektionen"])`
   - D01 as diamond: `D01{"Neuer oder bestehender<br/>Spielplatz?"}`

2. **Neuer Spielplatz path (5 nodes) ‚Äî use BLUE class (newpath):**
   - N01 rectangle: `N01["Bauabnahme nach SIA 118¬π<br/>Vertragliche Abnahme<br/>durch Architekt/Bauleiter"]`
   - N02 rectangle: `N02["Inspektion nach Installation¬≤<br/>Sicherheitspr√ºfung durch<br/>zertifizierte Fachperson"]`
   - D02 diamond: `D02{"M√§ngel festgestellt?"}`
   - N03 rectangle: `N03["M√§ngel an Ersteller/<br/>Hersteller zur√ºck<br/>zur Behebung"]`
   - N04 rounded-rect: `N04(["Spielplatz er√∂ffnen"])`

3. **Bestehender Spielplatz ‚Äî inspection branches (5 nodes) ‚Äî use GREEN class (inspection):**
   - E00 rounded-rect: `E00(["Inspektionszyklus<br/>beginnen"])`
   - Three inspection nodes as rectangles, using RENAMED terminology per user decision:
     - E01: `E01["Sichtkontrolle¬≥<br/>Sichtpr√ºfung auf<br/>offensichtliche Gefahren"]`
     - E02: `E02["Funktionskontrolle‚Å¥<br/>Funktionspr√ºfung,<br/>Verschleiss, Stabilit√§t"]`
     - E03: `E03["Jahreshauptinspektion‚Åµ<br/>Umfassende Pr√ºfung durch<br/>zertifizierte Fachperson"]`
   - E04 as parallelogram: `E04[/"Inspektionsbericht<br/>erstellen"/]`

   **Parallel branch layout:** To get side-by-side rendering in TD mode, define the three branch edges together without intervening sequential edges. Mermaid's auto-layout in TD mode will place nodes receiving edges from the same parent side-by-side. Edges from E00 to E01/E02/E03 should have frequency labels per user decision:
   - E00 -->|"w√∂chentlich"| E01
   - E00 -->|"pro Quartal"| E02
   - E00 -->|"j√§hrlich"| E03

   Then all three merge: E01 --> E04, E02 --> E04, E03 --> E04

4. **Post-inspection process (12 nodes):**
   - P01 rectangle (action class): `P01["Bericht archivieren‚Å∂"]`
   - D03 diamond: `D03{"M√§ngel festgestellt?"}`
   - P02 rectangle (action class): `P02["M√§ngel nach<br/>CEN/TR 17207‚Å∑<br/>klassifizieren"]`
   - D04 diamond: `D04{"Schweregrad?"}`
   - P03 rectangle: `P03["Konform: Keine Massnahme,<br/>nur Dokumentation"]`
   - P04 rectangle (URGENT/RED class): `P04["Ger√§t sperren‚Å∏<br/>Sofortige Sperrung bei<br/>sicherheitskritischen M√§ngeln"]`
   - P05 rectangle (action class): `P05["Massnahmenkatalog erstellen<br/>Priorisierung, Zuweisung,<br/>Terminierung"]`
   - D05 diamond: `D05{"Entscheidung:<br/>Budget, intern vs. extern,<br/>Priorisierung"}`
   - P06 rectangle (action class): `P06["Massnahmen umsetzen<br/>Reparaturen/Korrekturen<br/>ausf√ºhren"]`
   - P07 parallelogram (action class): `P07[/"Dokumentation<br/>bestehender M√§ngel:<br/>Nachverfolgung,<br/>Wiedervorlage"/]`
   - D06 diamond: `D06{"M√§ngel behoben?"}`
   - END rounded-rect: `END(["N√§chster Inspektionszyklus<br/>gem√§ss Zeitplan‚Åπ"])`

5. **All 31 edges** ‚Äî translate every edge from flowchart-content.md edge tables. Pay special attention to:
   - Loop: N03 -->|"Nachbesserung abgeschlossen"| N02 (back-arrow, must be clearly labeled)
   - Loop: D06 -->|"Nein"| P07 (unresolved defects loop back, must be clearly labeled: "Nein: Wiedervorlage<br/>n√§chste Inspektion")
   - Transition: N04 -->|"Spielplatz in Betrieb"| E00
   - D04 has FOUR outgoing edges: Konform‚ÜíP03, Empfohlen‚ÜíP05, Wichtig‚ÜíP05, Dringend‚ÜíP04
   - D03 "Nein" goes to END, "Ja" goes to P02
   - D06 "Ja" goes to END, "Nein" goes to P07
   - Use dotted line style (-.->)  for loop-back edges (N03‚ÜíN02 and D06‚ÜíP07) so loops are visually distinct, matching the existing flowchart's pattern for cycle arrows

6. **classDef styling** ‚Äî use Bootstrap-style alert colors matching existing-playground-flowchart.md for consistency:
   ```
   classDef startend fill:#f8f9fa,stroke:#6c757d,color:#495057
   classDef newpath fill:#d1ecf1,stroke:#0c5460,color:#0c5460
   classDef inspection fill:#d4edda,stroke:#155724,color:#155724
   classDef action fill:#fff3cd,stroke:#856404,color:#856404
   classDef urgent fill:#f8d7da,stroke:#721c24,color:#721c24
   classDef transition fill:#e2e3f1,stroke:#383d6e,color:#383d6e
   ```

   **Class assignments:**
   - startend: START, END
   - newpath: N01, N02, N03, N04 (blue ‚Äî new playground path)
   - inspection: E00, E01, E02, E03, E04 (green ‚Äî inspection nodes)
   - action: P01, P02, P03, P05, P06, P07 (yellow ‚Äî post-inspection actions)
   - urgent: P04 (red ‚Äî Ger√§t sperren)
   - Diamonds (D01-D06) left unstyled (default grey) for neutral decision appearance
   - transition: N04 could also use this if you want to highlight the new‚Üíexisting transition point (use discretion)

7. **Footnote box** ‚Äî add a styled node at the bottom of the diagram:
   ```
   FOOTNOTES["<b>Fussnoten</b><br/>¬π SIA 118 ‚Äî Vertragliche Bauabnahme, ersetzt nicht die Sicherheitsinspektion<br/>¬≤ SN EN 1176-7, 6.1a ‚Äî Inspektion nach Installation<br/>¬≥ SN EN 1176-7, 6.1b ‚Äî Visuelle Routineinspektion<br/>‚Å¥ SN EN 1176-7, 6.1c ‚Äî Operative Inspektion<br/>‚Åµ SN EN 1176-7, 6.1d ‚Äî J√§hrliche Hauptinspektion<br/>‚Å∂ SN EN 1176-7, 8.2.2 ‚Äî Dokumentationspflicht<br/>‚Å∑ CEN/TR 17207 ‚Äî M√§ngelklassifizierung<br/>‚Å∏ SN EN 1176-7, 6.2.1 ‚Äî Sofortmassnahmen bei Schweregrad Dringend<br/>‚Åπ SN EN 1176-7, 6.2.4 ‚Äî Inspektionsplan"]
   ```
   Style with a neutral class (light background, small border). Use `classDef footnote fill:#f8f9fa,stroke:#dee2e6,color:#495057`. Connect it to nothing (orphan node at the bottom). If Mermaid forces it into the flow, connect with invisible edge from END: `END ~~~ FOOTNOTES`

8. **Legend box** ‚Äî add a styled node explaining shapes and colors:
   ```
   LEGEND["<b>Legende</b><br/>‚ñ≠ Rechteck = Prozessschritt / Aktion<br/>‚óá Raute = Entscheidungspunkt<br/>‚¨≠ Abgerundetes Rechteck = Start / Ende<br/>‚ñ± Parallelogramm = Dokument / Bericht<br/><br/><b>Farben:</b><br/>üîµ Blau = Neuer Spielplatz<br/>üü¢ Gr√ºn = Inspektionen<br/>üü° Gelb = M√§ngel / Massnahmen<br/>üî¥ Rot = Kritische Sperrung<br/>‚ö™ Grau = Start / Ende"]
   ```
   IMPORTANT: Do NOT use actual emojis in the Mermaid code (FMT-04). Use colored Unicode squares (‚ñ†) or text labels instead for the color indicators. For example: "Blau ‚ñ† = Neuer Spielplatz" using HTML color spans if supported, or just text: "(blau) = Neuer Spielplatz". Test what renders.

   Style similarly to footnotes. Place adjacent to FOOTNOTES using `FOOTNOTES ~~~ LEGEND` or similar invisible edge.

**Superscript handling:** Use Unicode superscript characters (¬π¬≤¬≥‚Å¥‚Åµ‚Å∂‚Å∑‚Å∏‚Åπ) which render in most Mermaid viewers. These are NOT emojis and are safe for Mermaid. Already shown in node labels above.

**CRITICAL CHECK before finishing:** Count all node IDs in the final Mermaid code. Must have exactly: START, D01, N01, N02, D02, N03, N04, E00, E01, E02, E03, E04, P01, D03, P02, D04, P03, P04, P05, D05, P06, P07, D06, END = 24 flow nodes + FOOTNOTES + LEGEND = 26 total nodes. (Phase 1 counted 29 including D01-D06 as separate; recount: 2 start + 5 new + 5 existing + 12 post = 24 flow nodes, which matches since 6 diamonds are already counted within each section.)

**CRITICAL CHECK on edges:** Count all --> and -.-> arrows. Must have exactly 31 flow edges matching flowchart-content.md.

Wrap everything in a Markdown file with a title and the mermaid code fence.
  </action>
  <verify>
1. Open the file and count node IDs ‚Äî must find all 24 flow node IDs plus FOOTNOTES and LEGEND
2. Count edge arrows (-->, -.->)  ‚Äî must find exactly 31 flow edges
3. Verify all three inspection branches have frequency labels ("w√∂chentlich", "pro Quartal", "j√§hrlich")
4. Verify renamed terminology: "Sichtkontrolle", "Funktionskontrolle", "Jahreshauptinspektion" appear in node labels
5. Verify original norm terms appear in footnote box
6. Verify no emojis in the Mermaid code block
7. Verify classDef declarations exist for all 6 color classes
8. Verify superscript characters (¬π-‚Åπ) appear on the correct nodes
  </verify>
  <done>
inspektionen-flowchart.md exists with complete, syntactically valid Mermaid code containing all 24 flow nodes (correct shapes), 31 edges (correct labels), 6 classDef color classes, footnote box with 9 abbreviated references, legend box with shape/color explanations, and zero emojis
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify Mermaid diagram renders correctly</name>
  <what-built>Complete Mermaid flowchart in inspektionen-flowchart.md with all nodes, edges, styling, footnotes, and legend from the Phase 1 content structure. Preview generated in preview-flowchart.html.</what-built>
  <how-to-verify>
1. Open preview-flowchart.html in a browser (or paste the Mermaid code into mermaid.live)
2. Verify the diagram renders without errors (no red error boxes)
3. Check that the flow goes top-to-bottom with two clear entry paths (Neuer Spielplatz left, Bestehender Spielplatz right ‚Äî or vice versa)
4. Check that three inspection branches (Sichtkontrolle, Funktionskontrolle, Jahreshauptinspektion) appear side-by-side with frequency labels
5. Check that loop-back arrows are visible and labeled (defect‚Üíre-inspect, unresolved‚Üínext cycle)
6. Check color zones: blue nodes for new path, green for inspections, yellow for actions, red for Ger√§t sperren, grey for start/end
7. Check that footnote box and legend box are visible at the bottom
8. Check overall readability ‚Äî could a designer recreate this without playground safety knowledge?
  </how-to-verify>
  <resume-signal>Type "approved" to complete Phase 2, or describe any rendering issues, layout problems, or content corrections needed</resume-signal>
</task>

</tasks>

<verification>
1. inspektionen-flowchart.md exists and contains a ```mermaid code block
2. Mermaid code renders without syntax errors in mermaid.live or local preview
3. All German terminology matches SN EN 1176-7 (using renamed terms per user decision)
4. No emojis or special characters that break Mermaid rendering (FMT-04)
5. Diagram is self-contained: flow + footnotes + legend in one exportable unit
6. Color styling matches existing-playground-flowchart.md palette for consistency
</verification>

<success_criteria>
- FMT-01: Mermaid diagram renders without errors ‚úì (verified by checkpoint)
- FMT-02: German language with correct SN EN 1176-7 terminology ‚úì (renamed terms in nodes, original terms in footnotes)
- FMT-03: Clear enough for a visual designer ‚úì (verified by checkpoint)
- FMT-04: No emojis or special characters that break rendering ‚úì (verified by count check)
</success_criteria>

<output>
After completion, create `.planning/phases/02-mermaid-implementation/02-01-SUMMARY.md`
</output>
