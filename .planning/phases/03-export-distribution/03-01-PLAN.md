---
phase: 03-export-distribution
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - PSP-Inspektions-Flowchart/Inspektionsablauf.drawio
autonomous: true

must_haves:
  truths:
    - "draw.io file opens in draw.io (desktop or web) without errors"
    - "All 26 nodes from Mermaid diagram are present as individual editable shapes"
    - "All 31 edges are present as connectors linked to their source/target nodes"
    - "Nodes can be dragged and connectors follow automatically"
    - "Footnotes and legend entries are individual editable elements"
    - "Branding area exists for customer logo placement"
    - "Style library is included so new nodes match existing styling"
  artifacts:
    - path: "PSP-Inspektions-Flowchart/Inspektionsablauf.drawio"
      provides: "Native draw.io XML diagram with all flowchart content"
      contains: "mxGraphModel"
  key_links:
    - from: "inspektionen-flowchart.md"
      to: "PSP-Inspektions-Flowchart/Inspektionsablauf.drawio"
      via: "Content translation — all nodes, edges, labels, footnotes transferred"
---

<objective>
Build a native draw.io XML file (.drawio) containing the complete PSP Inspektions-Flowchart with all 26 nodes, 31 edges, footnotes, legend, branding area, and style library.

Purpose: This is the gold standard customer deliverable — a fully editable diagram where customers can move, resize, recolor, delete, and add nodes. Connectors must be linked to nodes so arrows follow when shapes are dragged.

Output: `PSP-Inspektions-Flowchart/Inspektionsablauf.drawio`
</objective>

<execution_context>
@/Users/jean-pierrekoenig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jean-pierrekoenig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@inspektionen-flowchart.md
@flowchart-content.md
@.planning/phases/03-export-distribution/03-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create delivery folder and build draw.io XML file</name>
  <files>PSP-Inspektions-Flowchart/Inspektionsablauf.drawio</files>
  <action>
Create the delivery folder `PSP-Inspektions-Flowchart/` at project root and build the complete draw.io XML file.

**draw.io XML structure:** The file must be native draw.io XML (mxGraphModel format), NOT an embedded image.

**Improved color palette** (refine Phase 2 colors for better print/screen quality, same semantic meaning):
- Start/End (grey): fill=#F5F5F5, stroke=#9E9E9E, font=#616161
- New playground path (blue): fill=#BBDEFB, stroke=#1565C0, font=#0D47A1
- Inspections (green): fill=#C8E6C9, stroke=#2E7D32, font=#1B5E20
- Actions/post-inspection (yellow/amber): fill=#FFF9C4, stroke=#F9A825, font=#E65100
- Urgent/critical (red): fill=#FFCDD2, stroke=#C62828, font=#B71C1C
- Footnote/legend (light grey): fill=#FAFAFA, stroke=#E0E0E0, font=#616161

**Layout — Top-to-bottom flow:**
Build a top-to-bottom layout matching the Mermaid flowchart structure. Use these approximate positioning guidelines (x,y coordinates in draw.io units):
- Canvas width ~1200px, height ~2400px
- START at top center (~x=500, y=20)
- D01 decision below START
- New playground path on the LEFT side (N01-N04, D02, N03)
- Existing playground fork on the RIGHT or CENTER-RIGHT (E00)
- Three inspection branches (E01, E02, E03) fan out horizontally, merge at E04
- Post-inspection process continues below E04 (P01, D03, P02, D04, etc.)
- END at bottom center
- FOOTNOTES and LEGEND positioned below END, side by side

**Node shapes in draw.io:**
- Rectangles (process steps): `shape=mxgraph.flowchart.process` or default rectangle
- Diamonds (decisions D01-D06): `rhombus` shape
- Rounded rectangles (START, END, N04, E00): `rounded=1`
- Parallelograms (E04, P07): `shape=parallelogram` or `shape=mxgraph.flowchart.data`

**Connectors:**
- All edges must be connected using `source` and `target` attributes referencing node IDs
- Regular edges: solid lines with arrows
- Loop-back edges (N03→N02, D06→P07): dashed lines (`dashed=1`)
- Edge labels from the Mermaid source must be included
- Use orthogonal routing (`edgeStyle=orthogonalEdgeStyle`) for clean layouts

**Nodes to create (all 26):**
START, D01, N01, N02, D02, N03, N04, E00, E01, E02, E03, E04, P01, D03, P02, D04, P03, P04, P05, D05, P06, P07, D06, END, FOOTNOTES, LEGEND

**Edges to create (all 31):**
Transfer all edges from the Mermaid diagram including labels. See @inspektionen-flowchart.md for the complete edge list.

**Branding area:**
Add a rectangle in the top-right corner (~200x80px) with placeholder text "PSP Logo" and a light border. Style it so customers can easily replace with their own logo image.

**Style library:**
Include custom styles in the diagram's XML `<mxStylesheet>` or as named styles so that when customers add new shapes, they can apply consistent styling. Define named styles for each category: startend, newpath, inspection, action, urgent, footnote.

**Footnotes and legend:**
- Each footnote (1-9) must be a separate text element, NOT a single grouped block
- Each legend entry (shape descriptions + color descriptions) must be a separate text element
- Group them visually in a bordered area but keep them individually editable

**German text:**
All node labels, edge labels, footnotes, and legend text must match the content in @flowchart-content.md and @inspektionen-flowchart.md exactly. All text is in German.
  </action>
  <verify>
1. File exists at `PSP-Inspektions-Flowchart/Inspektionsablauf.drawio`
2. File starts with `<?xml` or `<mxfile>` (valid draw.io XML)
3. Count node elements: grep for `vertex="1"` should find at least 26 entries (nodes + supporting elements)
4. Count edge elements: grep for `edge="1"` should find at least 31 entries
5. Verify connectors are linked: grep for `source=` and `target=` on edge elements
6. Verify branding area exists: grep for "PSP Logo"
7. Verify dashed loop-back edges: grep for `dashed=1`
  </verify>
  <done>
A native draw.io XML file exists with all 26 nodes as individual editable shapes, all 31 connectors linked to source/target nodes, dashed loop-back edges, branding area, footnotes as individual elements, legend entries as individual elements, improved color palette, and top-to-bottom layout.
  </done>
</task>

<task type="auto">
  <name>Task 2: Validate draw.io file structure and fix any issues</name>
  <files>PSP-Inspektions-Flowchart/Inspektionsablauf.drawio</files>
  <action>
Validate the draw.io XML file for correctness:

1. **XML validity:** Ensure the file is well-formed XML (no unclosed tags, proper escaping of special characters in German text like umlauts)
2. **Node completeness:** Cross-reference every node ID from the Mermaid source (START, D01, N01, N02, D02, N03, N04, E00, E01, E02, E03, E04, P01, D03, P02, D04, P03, P04, P05, D05, P06, P07, D06, END, FOOTNOTES, LEGEND) and confirm each exists in the XML
3. **Edge completeness:** Cross-reference every edge from the Mermaid source and confirm each exists with correct source/target
4. **Connector integrity:** Every edge element must have both `source` and `target` attributes pointing to valid node IDs
5. **Label accuracy:** Spot-check 5+ node labels against the Mermaid source for exact German text match
6. **Style application:** Verify each node category has the correct fill color applied

Fix any issues found. This is a quality gate before SVG generation in Plan 02.
  </action>
  <verify>
1. `xmllint --noout PSP-Inspektions-Flowchart/Inspektionsablauf.drawio` returns no errors (or manual XML parse check)
2. All 26 node IDs confirmed present
3. All 31 edges confirmed with source/target attributes
4. No orphaned connectors (edges pointing to non-existent nodes)
  </verify>
  <done>
The draw.io file is valid XML with all 26 nodes, all 31 edges correctly linked, accurate German labels, and proper color styling applied to each node category.
  </done>
</task>

</tasks>

<verification>
1. `PSP-Inspektions-Flowchart/Inspektionsablauf.drawio` exists and is valid XML
2. File opens in draw.io without errors (structure validates)
3. All 26 nodes present as individual shapes
4. All 31 edges present with linked connectors
5. Improved color palette applied consistently
6. Branding area present
7. Footnotes are individually editable elements
8. Legend entries are individually editable elements
</verification>

<success_criteria>
The draw.io file is a complete, native XML diagram that customers can open in draw.io, drag nodes (with connectors following), edit text, recolor shapes, and add new elements using the included style definitions. All content matches the Mermaid source exactly.
</success_criteria>

<output>
After completion, create `.planning/phases/03-export-distribution/03-01-SUMMARY.md`
</output>
