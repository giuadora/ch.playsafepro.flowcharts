---
phase: 07-flowchart-split-file-structure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Neuer-Spielplatz.drawio
  - Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Bestehender-Spielplatz.drawio
autonomous: false

must_haves:
  truths:
    - "FC1 (Neuer-Spielplatz.drawio) opens in draw.io and shows only the new playground commissioning path from Neuer Spielplatz through Inspektionszyklus beginnen"
    - "FC2 (Bestehender-Spielplatz.drawio) opens in draw.io and shows only the ongoing inspection cycle from Inspektionszyklus beginnen looping back via Naechster Inspektionszyklus"
    - "FC1 has no inspection branch nodes (E01, E02, E03) and no post-inspection nodes (P01, IHM, END)"
    - "FC2 has no new-playground nodes (N01, N02, D02, N03, N04, IPLAN) and no decision diamond D01"
    - "Both flowcharts display a subline below the main title — Neuer Spielplatz on FC1, Bestehender Spielplatz on FC2"
    - "Both flowcharts retain PSP logo and 3-column footer from v1.2"
  artifacts:
    - path: "Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Neuer-Spielplatz.drawio"
      provides: "FC1 new playground commissioning flowchart"
      contains: "Neuer Spielplatz"
    - path: "Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Bestehender-Spielplatz.drawio"
      provides: "FC2 ongoing inspection cycle flowchart"
      contains: "Bestehender Spielplatz"
  key_links:
    - from: "Neuer-Spielplatz.drawio"
      to: "node E00"
      via: "FC1 terminal node — Inspektionszyklus beginnen is the endpoint"
      pattern: "E00.*Inspektionszyklus"
    - from: "Bestehender-Spielplatz.drawio"
      to: "node END"
      via: "FC2 loop-back — END loops back to E00 conceptually"
      pattern: "END.*Naechster Inspektionszyklus"
---

<objective>
Split the single Spielplatzinspektionen.drawio flowchart into two independent draw.io files — one for the new playground commissioning path (FC1: Neuer Spielplatz) and one for the ongoing inspection cycle (FC2: Bestehender Spielplatz).

Purpose: Phase 7 establishes the two-file structure that v2.0 node modifications (Phase 8) and quality verification (Phase 9) will build upon. The current single flowchart with two entry paths becomes two focused, cleaner flowcharts.

Output: Two draw.io files with correct names, relevant nodes/edges only, subline titles, and retained branding.
</objective>

<execution_context>
@/Users/jean-pierrekoenig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jean-pierrekoenig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Spielplatzinspektionen.drawio
@.planning/phases/06-corporate-branding/06-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FC1 Neuer-Spielplatz.drawio from source</name>
  <files>Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Neuer-Spielplatz.drawio</files>
  <action>
    Create FC1 by copying Spielplatzinspektionen.drawio and modifying the XML as follows:

    **Diagram identity:**
    - Change diagram name attribute to "Neuer Spielplatz"

    **Title modifications:**
    - Keep the main title cell (id="title") text as-is: "Inspektion von Spielplatzgeraeten und Spielplatzboeden nach SN EN 1176/1177"
    - Add a NEW subtitle cell directly below the title with value "Neuer Spielplatz", styled: fontSize=10, fontStyle=2 (italic), fontColor=#2B579A (blue, matching the Neuer Spielplatz section color), centered. Position it at approximately y=58, same x and width as title, height=20.

    **Nodes to KEEP (FC1 path):**
    - START (Spielplatz-Inspektionen) — but restyle: remove the stadium/pill shape, make it a plain text or simple rounded rectangle as the entry point. Keep its current style and position.
    - N01 (Bauabnahme nach SIA 118) — keep as-is
    - N02 (Inspektion nach Installation) — keep as-is
    - D02 (Maengel festgestellt?) — keep as-is
    - N03 (Maengel an Ersteller/Hersteller zurueck) — keep as-is
    - N04 (Spielplatz eroeffnen) — keep as-is
    - IPLAN (Inspektionsplan erstellen) — keep as-is
    - E00 (Inspektionszyklus beginnen) — this becomes the TERMINAL node of FC1. Keep as-is (rounded rectangle, green).

    **Nodes to REMOVE entirely (delete these mxCell elements):**
    - D01 (the "Neuer oder bestehender Spielplatz?" decision diamond) — FC1 has only one path, no fork needed
    - E01, E02, E03 (the three inspection type nodes)
    - E04 (Inspektionsbericht erstellen)
    - NOTE (CEN/TR 17207 annotation)
    - P01 (Bericht archivieren)
    - IHM (Instandhaltungs-Management)
    - END (Naechster Inspektionszyklus)

    **Edges to REMOVE:**
    - e1 (START → D01) — replaced by direct START → N01
    - e2 (D01 → N01 "Neuer Spielplatz") — D01 is removed
    - e3 (D01 → E00 "Bestehender Spielplatz") — entire path removed
    - e10, e11, e12 (E00 → E01/E02/E03 fan-out) — inspection branches removed
    - e13, e14, e15 (E01/E02/E03 → E04 fan-in) — inspection branches removed
    - e16 (E04 → P01) — post-inspection removed
    - e17 (E04 → IHM) — post-inspection removed
    - e20 (IHM → END) — post-inspection removed
    - eNOTE (E04 → NOTE) — annotation removed

    **Edges to ADD/MODIFY:**
    - Create a new edge from START directly to N01 (replacing the old START → D01 → N01 path). Use orthogonal edge style, strokeColor=#2B579A (blue), strokeWidth=1.5.

    **Footnotes box:**
    - Keep only footnotes relevant to FC1. The FC1 path uses these footnote superscripts:
      - 1 (SIA 118 — on N01)
      - 2 (SN EN 1176-7, 6.1a — on N02)
    - Remove footnotes 3-8 from the FOOTNOTES cell value. Keep footnote numbering as-is (1 and 2).
    - Note: IPLAN does not currently carry a footnote superscript (REF-02 is Phase 8 work).
    - Resize the FOOTNOTES box to fit the reduced content (smaller height).

    **Legend box:**
    - Keep the LEGEND cell as-is (shapes and colors still apply to FC1).
    - Optional: Remove the "(Gruen) = Inspektionen" color line if no green inspection nodes remain after removing E01-E03. However, E00 IS green and IPLAN transition leads to green, so KEEP the green legend entry. Actually E00 is green-styled. Keep the full legend.

    **Branding to KEEP unchanged:**
    - brand (PSP logo at top-right)
    - footer-col1, footer-col2, footer-col3 (3-column footer)
    - QR1, QR1-label, QR2, QR2-label (keep for now; QR URLs will be updated in Phase 9)

    **Layout adjustment:**
    - After removing the inspection branch nodes (which occupied y=470-780 range), the remaining FC1 nodes (START at y=75 to E00 at y=400) leave significant empty space.
    - Re-center the flow content vertically within the A4 page (pageHeight=1123). The flow spans roughly y=75 to y=435 (360px). With footnotes/legend at y=925 and footer at y=1045, the content area is y=75 to y=925 (850px). Center the 360px flow within this 850px area: start at approximately y=320. Shift all flow nodes down by ~245px.
    - Keep horizontal centering as-is (nodes are already centered around x=397 midpoint of 794px page).
    - Adjust all edge waypoints/arrays to match the shifted node positions.
    - Keep footnotes, legend, footer, QR codes, and branding at their ORIGINAL positions (they are page-anchored, not flow-anchored).

    **Page settings:** Keep pageWidth=794, pageHeight=1123 (A4 portrait).
  </action>
  <verify>
    1. File exists at Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Neuer-Spielplatz.drawio
    2. XML is valid (well-formed): `python3 -c "import xml.etree.ElementTree as ET; ET.parse('Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Neuer-Spielplatz.drawio'); print('Valid XML')"`
    3. Grep confirms FC1 nodes present: START, N01, N02, D02, N03, N04, IPLAN, E00
    4. Grep confirms FC2 nodes absent: E01, E02, E03, E04, IHM, END (as mxCell ids)
    5. Grep confirms D01 (decision diamond) is absent
    6. Grep confirms "Neuer Spielplatz" subtitle exists
    7. Grep confirms brand, footer-col1, footer-col2, footer-col3 cells present
    8. Grep confirms FOOTNOTES cell contains footnotes 1 and 2 but NOT footnotes 3-8
  </verify>
  <done>
    Neuer-Spielplatz.drawio contains only the new playground commissioning path (START → N01 → N02 → D02 → N03/N04 → IPLAN → E00), has a "Neuer Spielplatz" subtitle, retains PSP branding, and has only FC1-relevant footnotes (1, 2). The file is valid draw.io XML with A4 page dimensions.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create FC2 Bestehender-Spielplatz.drawio from source</name>
  <files>Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Bestehender-Spielplatz.drawio</files>
  <action>
    Create FC2 by copying Spielplatzinspektionen.drawio and modifying the XML as follows:

    **Diagram identity:**
    - Change diagram name attribute to "Bestehender Spielplatz"

    **Title modifications:**
    - Keep the main title cell (id="title") text as-is: "Inspektion von Spielplatzgeraeten und Spielplatzboeden nach SN EN 1176/1177"
    - Add a NEW subtitle cell directly below the title with value "Bestehender Spielplatz", styled: fontSize=10, fontStyle=2 (italic), fontColor=#3C763D (green, matching the inspection cycle color), centered. Position at approximately y=58, same x and width as title, height=20.

    **Nodes to KEEP (FC2 path):**
    - E00 (Inspektionszyklus beginnen) — this becomes the START node of FC2. Keep green styling.
    - E01 (Sichtkontrolle) — keep as-is
    - E02 (Funktionskontrolle) — keep as-is
    - E03 (Jahreshauptinspektion) — keep as-is
    - E04 (Inspektionsbericht erstellen) — keep as-is (parallelogram document shape)
    - NOTE (CEN/TR 17207 annotation) — keep as-is
    - P01 (Bericht archivieren) — keep as-is
    - IHM (Instandhaltungs-Management) — keep as-is
    - END (Naechster Inspektionszyklus) — keep as-is

    **Nodes to REMOVE entirely (delete these mxCell elements):**
    - START (Spielplatz-Inspektionen starting oval)
    - D01 (Neuer oder bestehender Spielplatz? decision diamond)
    - N01 (Bauabnahme)
    - N02 (Inspektion nach Installation)
    - D02 (Maengel festgestellt?)
    - N03 (Maengel an Ersteller)
    - N04 (Spielplatz eroeffnen)
    - IPLAN (Inspektionsplan erstellen)

    **Edges to REMOVE:**
    - e1 (START → D01)
    - e2 (D01 → N01 "Neuer Spielplatz")
    - e3 (D01 → E00 "Bestehender Spielplatz") — E00 is now the start, no incoming edge needed from D01
    - e4 (N01 → N02)
    - e5 (N02 → D02)
    - e6 (D02 → N03 "Ja")
    - e7 (D02 → N04 "Nein")
    - e8 (N03 → N02 "Nachbesserung" dashed)
    - e9 (N04 → IPLAN "Spielplatz in Betrieb")
    - e9b (IPLAN → E00)

    **Edges to KEEP:**
    - e10 (E00 → E01 "woechentlich")
    - e11 (E00 → E02 "quartalsweise")
    - e12 (E00 → E03 "jaehrlich")
    - e13 (E01 → E04)
    - e14 (E02 → E04)
    - e15 (E03 → E04)
    - e16 (E04 → P01)
    - e17 (E04 → IHM)
    - e20 (IHM → END)
    - eNOTE (E04 → NOTE dashed)

    **Edge to ADD:**
    - Add a dashed loop-back edge from END back to E00, indicating the cycle repeats. Style: dashed=1, strokeColor=#6C757D (gray), strokeWidth=1.5. Route it along the left side of the diagram to avoid overlapping with the flow content. Use orthogonal routing with waypoints.

    **Footnotes box:**
    - Keep only footnotes relevant to FC2. The FC2 path uses these superscripts:
      - 3 (SN EN 1176-7, 6.1b — on E01 Sichtkontrolle)
      - 4 (SN EN 1176-7, 6.1c — on E02 Funktionskontrolle)
      - 5 (SN EN 1176-7, 6.1d — on E03 Jahreshauptinspektion)
      - 6 (SN EN 1176-7, 8.2.2 — on P01 Bericht archivieren)
      - 7 (CEN/TR 17207 — on NOTE annotation)
      - 8 (SN EN 1176-7, 6.2.4 — on END Inspektionsplan)
    - Remove footnotes 1 and 2. Keep footnotes 3-8 with their ORIGINAL numbering (to match the superscripts on nodes, which are NOT renumbered in this phase).
    - Resize the FOOTNOTES box if needed to fit 6 footnotes.

    **Legend box:**
    - Keep the LEGEND cell as-is. All shapes and colors remain relevant to FC2.
    - The "(Blau) = Neuer Spielplatz" legend entry can stay for now (it does no harm; cleanup is Phase 9 scope if needed).

    **Branding to KEEP unchanged:**
    - brand (PSP logo)
    - footer-col1, footer-col2, footer-col3 (3-column footer)
    - QR1, QR1-label, QR2, QR2-label (QR URLs updated in Phase 9)

    **Layout adjustment:**
    - The FC2 nodes currently span from E00 (y=400) to END (y=780), a ~380px flow.
    - After removing the new playground path (y=75-346 region), re-position the flow to use the full content area.
    - Content area: y=80 to y=920 (840px usable before footnotes). Center the 380px flow within: start at approximately y=310. Shift E00 up to y=~310 and adjust all other FC2 nodes accordingly (shift up by ~90px).
    - Adjust the fork-out edges (e10, e11, e12) and fan-in edges (e13, e14, e15) waypoints for the new positions.
    - Re-position the new loop-back edge (END → E00) waypoints for the adjusted layout.
    - Keep footnotes, legend, footer, QR codes, and branding at their ORIGINAL positions.

    **Page settings:** Keep pageWidth=794, pageHeight=1123 (A4 portrait).
  </action>
  <verify>
    1. File exists at Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Bestehender-Spielplatz.drawio
    2. XML is valid: `python3 -c "import xml.etree.ElementTree as ET; ET.parse('Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Bestehender-Spielplatz.drawio'); print('Valid XML')"`
    3. Grep confirms FC2 nodes present: E00, E01, E02, E03, E04, P01, IHM, END, NOTE
    4. Grep confirms FC1 nodes absent: D01, N01, N02, D02, N03, N04, IPLAN (as mxCell ids)
    5. Grep confirms START node is absent
    6. Grep confirms "Bestehender Spielplatz" subtitle exists
    7. Grep confirms brand, footer-col1, footer-col2, footer-col3 cells present
    8. Grep confirms FOOTNOTES cell contains footnotes 3-8 but NOT footnotes 1-2
    9. Grep confirms a loop-back edge from END to E00 exists (source="END" target="E00" with dashed=1)
  </verify>
  <done>
    Bestehender-Spielplatz.drawio contains only the inspection cycle path (E00 → E01/E02/E03 → E04 → P01/IHM → END → loop back to E00), has a "Bestehender Spielplatz" subtitle, retains PSP branding, and has only FC2-relevant footnotes (3-8). A dashed loop-back edge connects END to E00. The file is valid draw.io XML with A4 page dimensions.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify both flowcharts in draw.io</name>
  <files>
    Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Neuer-Spielplatz.drawio
    Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Bestehender-Spielplatz.drawio
  </files>
  <action>
    Human visual verification of both split flowcharts in draw.io editor.

    **What was built:**
    Two independent draw.io flowcharts split from the original single file:
    - FC1: Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Neuer-Spielplatz.drawio
    - FC2: Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Bestehender-Spielplatz.drawio

    **How to verify:**
    1. Open Neuer-Spielplatz.drawio in draw.io (app.diagrams.net or desktop)
       - Verify the title reads "Inspektion von Spielplatzgeraeten..." with "Neuer Spielplatz" subtitle in blue
       - Verify the flow shows: START → Bauabnahme → Inspektion nach Installation → Maengel? → (loop or) Spielplatz eroeffnen → Inspektionsplan erstellen → Inspektionszyklus beginnen
       - Verify NO inspection branch nodes (Sichtkontrolle, Funktionskontrolle, Jahreshauptinspektion) appear
       - Verify PSP logo in top-right and 3-column footer at bottom
       - Verify footnotes show only footnotes 1 and 2
       - Verify content is reasonably centered on the A4 page

    2. Open Bestehender-Spielplatz.drawio in draw.io
       - Verify the title reads "Inspektion von Spielplatzgeraeten..." with "Bestehender Spielplatz" subtitle in green
       - Verify the flow shows: Inspektionszyklus beginnen → three inspection branches → Inspektionsbericht → Bericht archivieren / Instandhaltungs-Management → Naechster Inspektionszyklus → (loop back)
       - Verify NO new playground nodes (Bauabnahme, Inspektion nach Installation, Maengel decision) appear
       - Verify PSP logo in top-right and 3-column footer at bottom
       - Verify footnotes show only footnotes 3-8
       - Verify content is reasonably centered on the A4 page
       - Verify dashed loop-back arrow from END to E00 is visible

    3. Verify both files fit on A4 page without overflow

    **Resume signal:** Type "approved" or describe issues found
  </action>
  <verify>Human confirms both flowcharts display correctly in draw.io with proper content, layout, and branding</verify>
  <done>Both flowcharts approved by user as visually correct in draw.io editor</done>
</task>

</tasks>

<verification>
Phase 7 is complete when:
1. Two separate .drawio files exist with correct names (Neuer-Spielplatz.drawio, Bestehender-Spielplatz.drawio)
2. FC1 contains ONLY new playground path nodes (START, N01, N02, D02, N03, N04, IPLAN, E00)
3. FC2 contains ONLY inspection cycle nodes (E00, E01, E02, E03, E04, NOTE, P01, IHM, END)
4. Each flowchart has its own subline below the main title
5. Both flowcharts retain PSP logo and 3-column corporate footer
6. Both files are valid draw.io XML with A4 page dimensions
7. Both files have only their relevant footnotes
8. Human verification confirms visual correctness in draw.io
</verification>

<success_criteria>
- `ls Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Neuer-Spielplatz.drawio` returns the file
- `ls Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Bestehender-Spielplatz.drawio` returns the file
- Both files parse as valid XML
- grep for node IDs confirms correct content distribution
- Human approved both flowcharts visually in draw.io
</success_criteria>

<output>
After completion, create `.planning/phases/07-flowchart-split-file-structure/07-01-SUMMARY.md`
</output>
