---
phase: 09-documentation-quality-verification
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Neuer-Spielplatz.svg
  - Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Neuer-Spielplatz.pdf
  - Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Bestehender-Spielplatz.svg
  - Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Bestehender-Spielplatz.pdf
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Neuer-Spielplatz.svg exists and visually matches Neuer-Spielplatz.drawio (same nodes, positions, colors, fonts)"
    - "Bestehender-Spielplatz.svg exists and visually matches Bestehender-Spielplatz.drawio (same nodes, positions, colors, fonts)"
    - "Neuer-Spielplatz.pdf exists as single-page A4 with all flowchart content and branding"
    - "Bestehender-Spielplatz.pdf exists as single-page A4 with all flowchart content and branding"
  artifacts:
    - path: "Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Neuer-Spielplatz.svg"
      provides: "A4 SVG export of FC1 with PSP branding, all nodes, edges, legend, footer"
    - path: "Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Neuer-Spielplatz.pdf"
      provides: "A4 PDF export of FC1 generated from SVG via Chrome headless"
    - path: "Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Bestehender-Spielplatz.svg"
      provides: "A4 SVG export of FC2 with PSP branding, all nodes, edges, legend, footer"
    - path: "Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Bestehender-Spielplatz.pdf"
      provides: "A4 PDF export of FC2 generated from SVG via Chrome headless"
  key_links:
    - from: "Neuer-Spielplatz.svg"
      to: "Neuer-Spielplatz.drawio"
      via: "SVG elements match draw.io mxCell positions, styles, and content exactly"
    - from: "Bestehender-Spielplatz.svg"
      to: "Bestehender-Spielplatz.drawio"
      via: "SVG elements match draw.io mxCell positions, styles, and content exactly"
    - from: "Neuer-Spielplatz.pdf"
      to: "Neuer-Spielplatz.svg"
      via: "generate-pdf.sh Chrome headless rendering"
    - from: "Bestehender-Spielplatz.pdf"
      to: "Bestehender-Spielplatz.svg"
      via: "generate-pdf.sh Chrome headless rendering"
---

<objective>
Generate SVG and PDF exports for both split flowcharts (Neuer-Spielplatz and Bestehender-Spielplatz) to complete the v2.0 delivery package.

Purpose: Close the single remaining verification gap — the .drawio source files exist and are quality-verified, but .svg and .pdf exports were never generated. The README files and QR codes already reference these files, so they must exist for the delivery package to be complete and functional.

Output: 4 export files (2 SVG + 2 PDF) completing the v2.0 delivery package.
</objective>

<execution_context>
@/Users/jean-pierrekoenig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jean-pierrekoenig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-documentation-quality-verification/09-VERIFICATION.md
@.planning/phases/09-documentation-quality-verification/09-02-SUMMARY.md

# Source files (draw.io XML to extract coordinates and styles from)
@Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Neuer-Spielplatz.drawio
@Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Bestehender-Spielplatz.drawio

# Reference: existing SVG export for v1.2 (same approach, same structure)
@Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Spielplatzinspektionen.svg

# Reference: existing PDF generation script
@generate-pdf.sh
@verify-a4.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Generate SVG exports for both split flowcharts from draw.io XML</name>
  <files>
    Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Neuer-Spielplatz.svg
    Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Bestehender-Spielplatz.svg
  </files>
  <action>
    Generate SVG files for both Neuer-Spielplatz.drawio (FC1) and Bestehender-Spielplatz.drawio (FC2) by reading each draw.io XML and constructing a faithful SVG rendering. Follow the exact same approach used in Phase 05-02 (which generated Spielplatzinspektionen.svg) — use the existing Spielplatzinspektionen.svg as a structural reference for SVG conventions.

    **For each flowchart, construct the SVG by reading the .drawio XML source file:**

    **SVG canvas (both files):**
    - Width: 794, Height: 1123 (A4 at 96 DPI)
    - viewBox="0 0 794 1123"
    - Background: white (#FFFFFF)
    - Font: Helvetica, Arial, sans-serif (reference only, no embedding)

    **SVG structure (matching existing Spielplatzinspektionen.svg):**
    1. XML declaration and SVG root element
    2. `<defs>` section with arrowhead marker and CSS classes for node colors and edge colors
    3. White background rect
    4. Grouped elements: metadata (title, logo), flow nodes, edges, info boxes (footnotes, legend), footer

    **Read each .drawio file to extract all mxCell elements.** For each mxCell with `vertex="1"`:
    - Extract x, y, width, height from child `<mxGeometry>`
    - Extract style properties: fillColor, strokeColor, fontColor, fontSize, shape, rounded, arcSize, dashed, fontStyle, align, verticalAlign, whiteSpace, html, etc.
    - Extract `value` attribute (the displayed text) — convert HTML entities (`&lt;br&gt;` to line breaks, `&lt;b&gt;` to bold, `&lt;sup&gt;` to superscript)

    **Node rendering rules by draw.io style properties:**
    - `rounded=1;arcSize=50` → rounded rectangle (rx/ry = height/2) for terminal/pill nodes
    - `shape=rhombus` → diamond (rotated via polygon with 4 points)
    - `shape=parallelogram` → parallelogram (polygon with 4 points, top shifted)
    - `shape=process` → double-bordered subprocess rectangle (inner rect 5px inset on left/right)
    - `shape=image` → `<image>` element (for PSP logo — extract CDN URL from style)
    - `dashed=1` → dashed border (stroke-dasharray)
    - Default → standard rectangle

    **Color palette (extract from each draw.io file's actual style attributes):**
    - Gray: fill=#E9ECEF, stroke=#6C757D, text=#343A40
    - Blue: fill=#D6E4F0, stroke=#2B579A, text=#1F3864
    - Green: fill=#DFF0D8, stroke=#3C763D, text=#2D572C
    - Yellow: fill=#FFF3CD, stroke=#856404, text=#533F03
    - Info boxes: fill=#F8F9FA, stroke=#DEE2E6, text=#495057
    - Footer: text=#6C757D

    **Edge rendering (for each mxCell with `edge="1"`):**
    - Read `source` and `target` attributes to identify connected nodes
    - Read `<Array>` of `<mxPoint>` elements within mxGeometry for waypoints
    - Use orthogonal routing (right-angle paths) matching draw.io edgeStyle
    - Stroke width: 1.5
    - Arrowhead marker at end (reference `#arrowhead` from defs)
    - Edge color matches source/section area color
    - Dashed edges use stroke-dasharray="5,5"
    - Edge labels: read `value` attribute, position at edge midpoint or per mxGeometry offset

    **Text rendering:**
    - Convert `&lt;br&gt;` and `&lt;br/&gt;` to SVG `<tspan>` elements with `dy` offsets for line breaks
    - Font sizes: read from each cell's style (fontSize property)
    - Text anchor: `middle` for centered text in nodes, `start` for left-aligned (footnotes, legend col1, footer col1), `end` for right-aligned (footer col3)
    - Multi-line text: use `<tspan x="center" dy="lineHeight">` for each line
    - Superscripts (`<sup>`): render as smaller text with slight negative dy offset

    **Elements to include (read ALL mxCells from each .drawio file):**
    - PSP logo image (shape=image with CDN URL)
    - Title text
    - All flow nodes (rectangles, diamonds, pills, parallelograms, subprocess)
    - All edges with labels
    - Footnotes info box
    - Legend info box (including subprocess symbol entry)
    - QR code images (shape=image with base64 data — include as `<image>` elements)
    - 3-column footer (footer-col1, footer-col2, footer-col3)

    **Quality requirements:**
    - All node positions must match draw.io mxGeometry exactly (same x, y, width, height)
    - All colors must match draw.io style properties exactly
    - All text content must match draw.io value properties exactly
    - SVG must be valid XML (all tags closed, attributes properly quoted)
    - A4 dimensions: 794x1123 (width x height)

    **IMPORTANT:** These are two different flowcharts with different nodes, edges, and layouts. Read each .drawio file independently — do NOT copy one and modify. FC1 (Neuer-Spielplatz) has the new playground commissioning flow, FC2 (Bestehender-Spielplatz) has the existing playground inspection cycle. They have different node IDs, different text, different edge routing, and different layouts (though same page size and branding).
  </action>
  <verify>
    For each SVG file:
    1. File exists at expected path
    2. SVG root has width="794" height="1123" and viewBox="0 0 794 1123"
    3. Contains all flow nodes from the corresponding .drawio file (count vertex mxCells in drawio, match SVG elements)
    4. Contains all edges from the corresponding .drawio file
    5. Contains PSP logo image element
    6. Contains 3-column footer
    7. Contains legend with subprocess symbol entry
    8. Contains QR code images
    9. Valid XML (python3 -c "import xml.etree.ElementTree as ET; ET.parse('file.svg')")
    10. Run verify-a4.py on each SVG to confirm A4 bounds compliance
  </verify>
  <done>
    Both Neuer-Spielplatz.svg and Bestehender-Spielplatz.svg exist as valid A4 SVG files faithfully reproducing their respective draw.io sources with all nodes, edges, branding, legend, QR codes, and footer.
  </done>
</task>

<task type="auto">
  <name>Task 2: Generate PDF exports from SVGs using existing Chrome headless script</name>
  <files>
    Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Neuer-Spielplatz.pdf
    Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Bestehender-Spielplatz.pdf
  </files>
  <action>
    Use the existing `generate-pdf.sh` script (created in Phase 06-02) to generate PDF exports from the SVGs created in Task 1.

    Run for each flowchart:
    ```bash
    bash generate-pdf.sh Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Neuer-Spielplatz.svg
    bash generate-pdf.sh Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Bestehender-Spielplatz.svg
    ```

    The script automatically:
    1. Runs verify-a4.py pre-flight check on the SVG
    2. Creates temporary HTML wrapper with zero-margin CSS
    3. Uses Chrome headless to render to single-page A4 PDF
    4. Outputs PDF alongside the SVG

    Expected outputs:
    - `Neuer-Spielplatz.pdf` — single-page A4, ~100-150KB
    - `Bestehender-Spielplatz.pdf` — single-page A4, ~100-150KB

    If generate-pdf.sh fails (e.g., bounds check failure), fix the SVG from Task 1 before re-running.

    After generation, verify each PDF exists and has reasonable file size (> 50KB indicates actual content was rendered, not an empty page).
  </action>
  <verify>
    1. Both PDF files exist at expected paths
    2. File sizes > 50KB each (indicates actual content rendered)
    3. generate-pdf.sh exit code 0 for both runs (no bounds violations)
  </verify>
  <done>
    Both Neuer-Spielplatz.pdf and Bestehender-Spielplatz.pdf exist as single-page A4 PDFs with complete flowchart content and branding, generated from their respective SVGs via Chrome headless.
  </done>
</task>

</tasks>

<verification>
After both tasks complete, verify the full delivery package:

1. All 4 export files exist:
   - `ls Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Neuer-Spielplatz.{svg,pdf}`
   - `ls Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Bestehender-Spielplatz.{svg,pdf}`

2. SVG validity:
   - `python3 -c "import xml.etree.ElementTree as ET; ET.parse('Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Neuer-Spielplatz.svg')"`
   - `python3 -c "import xml.etree.ElementTree as ET; ET.parse('Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Bestehender-Spielplatz.svg')"`

3. A4 bounds compliance:
   - `python3 verify-a4.py Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Neuer-Spielplatz.svg`
   - `python3 verify-a4.py Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Bestehender-Spielplatz.svg`

4. PDF file sizes > 50KB each

5. Complete v2.0 delivery package now has for each flowchart: .drawio + .svg + .pdf + .md (README)
</verification>

<success_criteria>
- 4 new files exist: Neuer-Spielplatz.svg, Neuer-Spielplatz.pdf, Bestehender-Spielplatz.svg, Bestehender-Spielplatz.pdf
- Both SVGs are valid XML with A4 dimensions (794x1123)
- Both SVGs pass verify-a4.py bounds check
- Both PDFs are single-page A4 with content (file size > 50KB)
- Phase 9 VERIFICATION.md gap closed: "Complete delivery package exists for both flowcharts" now TRUE
</success_criteria>

<output>
After completion, create `.planning/phases/09-documentation-quality-verification/09-03-SUMMARY.md`
</output>
