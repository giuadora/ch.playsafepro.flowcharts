---
phase: 09-documentation-quality-verification
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Neuer-Spielplatz.svg
  - Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Bestehender-Spielplatz.svg
  - Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Neuer-Spielplatz.pdf
  - Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Bestehender-Spielplatz.pdf
  - Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Neuer-Spielplatz.md
  - Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Bestehender-Spielplatz.md
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Subprocess double-border renders correctly on subprocess nodes in both SVG exports"
    - "Mermaid flowcharts use correct node types matching draw.io sources (subprocess nodes use [[text]] syntax)"
  artifacts:
    - path: "Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Neuer-Spielplatz.svg"
      provides: "Correct subprocess rendering for IPLAN node"
      contains: "<line"
    - path: "Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Bestehender-Spielplatz.svg"
      provides: "Correct subprocess rendering for IHM node"
      contains: "<line"
    - path: "Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Neuer-Spielplatz.pdf"
      provides: "PDF regenerated from corrected SVG"
    - path: "Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Bestehender-Spielplatz.pdf"
      provides: "PDF regenerated from corrected SVG"
    - path: "Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Neuer-Spielplatz.md"
      provides: "IPLAN uses subprocess syntax"
      contains: '[[\"Inspektionsplan erstellen'
    - path: "Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Bestehender-Spielplatz.md"
      provides: "IHM uses subprocess syntax"
      contains: '[[\"Instandhaltungs-Management'
  key_links:
    - from: "Neuer-Spielplatz.svg"
      to: "Neuer-Spielplatz.drawio"
      via: "IPLAN shape=process -> two vertical <line> elements"
      pattern: "<line.*x1=\"307\".*x2=\"307\""
    - from: "Bestehender-Spielplatz.svg"
      to: "Bestehender-Spielplatz.drawio"
      via: "IHM shape=process -> two vertical <line> elements"
      pattern: "<line.*x1=\"327\".*x2=\"327\""
    - from: "Neuer-Spielplatz.pdf"
      to: "Neuer-Spielplatz.svg"
      via: "Chrome headless rendering from corrected SVG"
    - from: "Bestehender-Spielplatz.pdf"
      to: "Bestehender-Spielplatz.svg"
      via: "Chrome headless rendering from corrected SVG"
---

<objective>
Fix two UAT failures: (1) subprocess double-border rendering in SVGs uses incorrect inner rectangle instead of vertical lines, and (2) Mermaid files missing subprocess `[["text"]]` syntax for subprocess nodes.

Purpose: Close all remaining UAT gaps so v2.0 Flowchart Split passes user acceptance testing.
Output: Corrected SVGs, regenerated PDFs, and fixed Mermaid files.
</objective>

<execution_context>
@/Users/jean-pierrekoenig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jean-pierrekoenig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-documentation-quality-verification/09-03-SUMMARY.md
@.planning/debug/subprocess-double-border-incorrect.md
@.planning/debug/mermaid-subprocess-type-mismatch.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix subprocess double-border in both SVGs and regenerate PDFs</name>
  <files>
    Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Neuer-Spielplatz.svg
    Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Bestehender-Spielplatz.svg
    Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Neuer-Spielplatz.pdf
    Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Bestehender-Spielplatz.pdf
  </files>
  <action>
    Fix the subprocess (shape=process) double-border rendering in both SVG files. The current implementation incorrectly uses an inner rectangle inset on all four sides. The correct rendering (matching the reference Spielplatzinspektionen.svg) uses two vertical `<line>` elements, 10px inset from left and right edges, spanning the full height of the outer rectangle.

    **Neuer-Spielplatz.svg — IPLAN node (lines 91-96):**
    Replace the inner rect on line 93:
    ```
    <rect x="302" y="645" width="190" height="40" fill="none" stroke="#2B579A" stroke-width="1" />
    ```
    With two vertical lines:
    ```
    <line x1="307" y1="640" x2="307" y2="690" stroke="#2B579A" stroke-width="1" />
    <line x1="487" y1="640" x2="487" y2="690" stroke="#2B579A" stroke-width="1" />
    ```
    Math: outer rect x=297, width=200 -> left line at 297+10=307, right line at 297+200-10=487. Y from 640 to 640+50=690.

    **Bestehender-Spielplatz.svg — IHM node (lines 102-107):**
    Replace the inner rect on line 104:
    ```
    <rect x="322" y="670" width="150" height="25" fill="none" stroke="#3C763D" stroke-width="1" />
    ```
    With two vertical lines:
    ```
    <line x1="327" y1="665" x2="327" y2="700" stroke="#3C763D" stroke-width="1" />
    <line x1="467" y1="665" x2="467" y2="700" stroke="#3C763D" stroke-width="1" />
    ```
    Math: outer rect x=317, width=160 -> left line at 317+10=327, right line at 317+160-10=467. Y from 665 to 665+35=700.

    After fixing both SVGs, regenerate the PDFs using the existing script:
    ```
    bash generate-pdf.sh Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Neuer-Spielplatz.svg
    bash generate-pdf.sh Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Bestehender-Spielplatz.svg
    ```
  </action>
  <verify>
    1. grep for `<line` in both SVGs confirms vertical line elements exist (no inner `<rect` with fill="none" remains)
    2. grep confirms x1="307" and x1="487" in Neuer-Spielplatz.svg
    3. grep confirms x1="327" and x1="467" in Bestehender-Spielplatz.svg
    4. Both PDFs regenerated successfully (file size > 50KB)
    5. python3 -c "import xml.etree.ElementTree as ET; ET.parse('Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Neuer-Spielplatz.svg')" exits 0
    6. python3 -c "import xml.etree.ElementTree as ET; ET.parse('Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Bestehender-Spielplatz.svg')" exits 0
  </verify>
  <done>
    Both SVGs render subprocess nodes with two vertical lines (10px inset from left/right edges, full height) matching the reference Spielplatzinspektionen.svg pattern. Both PDFs regenerated from the corrected SVGs.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix Mermaid subprocess syntax for IPLAN and IHM nodes</name>
  <files>
    Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Neuer-Spielplatz.md
    Inspektion-von-Spielplatzgeraeten-und-Spielplatzboeden/Bestehender-Spielplatz.md
  </files>
  <action>
    Fix both Mermaid files to use subprocess syntax `[["text"]]` for the nodes that have `shape=process` in the draw.io sources.

    **Neuer-Spielplatz.md — IPLAN node (line 18):**
    Change from:
    ```
    IPLAN["Inspektionsplan erstellen³"]
    ```
    To:
    ```
    IPLAN[["Inspektionsplan erstellen³"]]
    ```

    **Bestehender-Spielplatz.md — IHM node (line 31):**
    Change from:
    ```
    IHM["Instandhaltungs-Management"]
    ```
    To:
    ```
    IHM[["Instandhaltungs-Management"]]
    ```

    No other nodes should be changed. Only IPLAN and IHM have `shape=process` in the draw.io sources.
  </action>
  <verify>
    1. grep for `IPLAN\[\["Inspektionsplan` in Neuer-Spielplatz.md returns a match
    2. grep for `IHM\[\["Instandhaltungs` in Bestehender-Spielplatz.md returns a match
    3. Verify no other nodes use `[[` syntax (only IPLAN and IHM should be subprocesses)
    4. Both files still contain valid `mermaid` code blocks
  </verify>
  <done>
    IPLAN in Neuer-Spielplatz.md uses `[["Inspektionsplan erstellen³"]]` subprocess syntax. IHM in Bestehender-Spielplatz.md uses `[["Instandhaltungs-Management"]]` subprocess syntax. Both match their draw.io `shape=process` designations.
  </done>
</task>

</tasks>

<verification>
- Both SVG subprocess nodes use vertical `<line>` elements (not inner `<rect>`) matching Spielplatzinspektionen.svg reference pattern
- Both Mermaid subprocess nodes use `[["text"]]` syntax matching draw.io `shape=process` attribute
- Both PDFs regenerated from corrected SVGs with file size > 50KB
- All SVGs are valid XML
- No regressions: all other nodes, edges, footnotes, legends, QR codes, and footer content unchanged
</verification>

<success_criteria>
1. UAT Test 1 (FC1 SVG Export Visual Match) passes: subprocess double-border on IPLAN renders correctly with vertical lines
2. UAT Test 5 (Mermaid Flowcharts) passes: IPLAN uses `[["text"]]` in FC1 Mermaid, IHM uses `[["text"]]` in FC2 Mermaid
3. All 7 UAT tests pass (no regressions on tests 2, 3, 4, 6, 7)
</success_criteria>

<output>
After completion, create `.planning/phases/09-documentation-quality-verification/09-04-SUMMARY.md`
</output>
